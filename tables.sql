-- Tabela central: TB_PESSOA
CREATE TABLE TB_PESSOA (
    ID_PESSOA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    EMAIL VARCHAR2(100) NOT NULL,
    TELEFONE VARCHAR2(20)
);

-- Pessoa física
CREATE TABLE TB_PESSOA_FISICA (
    ID_PESSOA_FISICA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PESSOA NUMBER NOT NULL,
    NOME VARCHAR2(100) NOT NULL,
    CPF CHAR(11) UNIQUE NOT NULL,
    DT_NASC DATE,
    CONSTRAINT FK_PF_PESSOA FOREIGN KEY (ID_PESSOA) REFERENCES TB_PESSOA(ID_PESSOA)
);

-- Pessoa jurídica
CREATE TABLE TB_PESSOA_JURIDICA (
    ID_PESSOA_JURIDICA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PESSOA NUMBER NOT NULL,
    RAZAO_SOCIAL VARCHAR2(100) NOT NULL,
    CNPJ CHAR(14) UNIQUE NOT NULL,
    NM_FANTASIA VARCHAR(100),
    CONSTRAINT FK_PJ_PESSOA FOREIGN KEY (ID_PESSOA) REFERENCES TB_PESSOA(ID_PESSOA)
);

-- Endereço
CREATE TABLE TB_ENDERECO (
    ID_ENDERECO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PESSOA NUMBER NOT NULL,
    LOGRADOURO VARCHAR2(100),
    NUMERO VARCHAR2(10),
    COMPLEMENTO VARCHAR2(100),
    BAIRRO VARCHAR2(100),
    CIDADE VARCHAR2(100),
    ESTADO VARCHAR2(2),
    CEP CHAR(8),
    TIPO_ENDERECO VARCHAR2(100),
    CONSTRAINT FK_ENDERECO_PESSOA FOREIGN KEY (ID_PESSOA) REFERENCES TB_PESSOA(ID_PESSOA)
);

-- Cadastro
CREATE TABLE TB_CADASTRO (
    ID_CADASTRO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_PESSOA NUMBER NOT NULL,
    DT_CADASTRO DATE DEFAULT SYSDATE,
    STATUS VARCHAR(7) CHECK (STATUS IN ('ativo', 'inativo')),
    CONSTRAINT FK_CADASTRO_PESSOA FOREIGN KEY (ID_PESSOA) REFERENCES TB_PESSOA(ID_PESSOA)
);

-- Conta
CREATE TABLE TB_CONTA (
    ID_CONTA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CADASTRO NUMBER NOT NULL,
    NM_CONTA CHAR(10) NOT NULL,
    DIGITO_VERIFICADOR CHAR(1) NOT NULL,
    AGENCIA VARCHAR2(4) NOT NULL,
    TIPO_CONTA VARCHAR2(20) NOT NULL,
    SALDO NUMBER(15,2) DEFAULT 0,
    DT_ABERTURA DATE DEFAULT SYSDATE,
    STATUS VARCHAR(7) CHECK (STATUS IN ('ativo', 'inativo')),
    CONSTRAINT FK_CONTA_CADASTRO FOREIGN KEY (ID_CADASTRO) REFERENCES TB_CADASTRO(ID_CADASTRO)
);

-- Cartão
CREATE TABLE TB_CARTAO (
    ID_CARTAO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CONTA NUMBER NOT NULL,
    NUMERO_CARTAO CHAR(16) NOT NULL UNIQUE,
    TIPO_CARTAO VARCHAR2(10) CHECK (TIPO_CARTAO IN ('debito', 'credito', 'prepago', 'multiplo', 'virtual', 'corporativo')),
    DT_EMISSAO DATE,
    DATA_VALIDADE DATE,
    LIMITE_CREDITO NUMBER(15,2),
    STATUS VARCHAR(7) CHECK (STATUS IN ('ativo', 'inativo')),
    CONSTRAINT FK_CARTAO_CONTA FOREIGN KEY (ID_CONTA) REFERENCES TB_CONTA(ID_CONTA)
);

-- Transação
CREATE TABLE TB_TRANSACAO (
    ID_TRANSACAO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CONTA NUMBER NOT NULL,
    TIPO_TRANSACAO VARCHAR2(20),
    VALOR NUMBER(15,2) NOT NULL,
    DATA_TRANSACAO DATE DEFAULT SYSDATE,
    DESCRICAO VARCHAR2(255),
    CONSTRAINT FK_TRANSACAO_CONTA FOREIGN KEY (ID_CONTA) REFERENCES TB_CONTA(ID_CONTA)
);

-- Empréstimo
CREATE TABLE TB_EMPRESTIMO (
    ID_EMPRESTIMO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CONTA NUMBER NOT NULL,
    VALOR_TOTAL NUMBER(15,2) NOT NULL,
    VALOR_PARCELA NUMBER(15,2) NOT NULL,
    NM_PARCELAS NUMBER,
    TX_JUROS NUMBER(5,2),
    DATA_CONTRATACAO DATE,
    DATA_VENCIMENTO DATE,
    STATUS VARCHAR(7) CHECK (STATUS IN ('ativo', 'inativo')),
    CONSTRAINT FK_EMPRESTIMO_CONTA FOREIGN KEY (ID_CONTA) REFERENCES TB_CONTA(ID_CONTA)
);

-- Investimento
CREATE TABLE TB_INVESTIMENTO (
    ID_INVESTIMENTO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ID_CONTA NUMBER NOT NULL,
    TIPO_INVESTIMENTO VARCHAR2(50),
    VALOR_APLICACAO NUMBER(15,2) NOT NULL,
    DT_APLICACAO DATE,
    DATA_VENCIMENTO DATE,
    RENTABILIDADE NUMBER(5,2),
    STATUS VARCHAR(7) CHECK (STATUS IN ('ativo', 'inativo')),
    CONSTRAINT FK_INVESTIMENTO_CONTA FOREIGN KEY (ID_CONTA) REFERENCES TB_CONTA(ID_CONTA)
);

